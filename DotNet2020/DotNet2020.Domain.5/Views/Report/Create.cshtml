@model DotNet2020.Domain._5.Models.CreateReportModel
@using Kendo.Mvc.UI;
<style type="text/css">
    .container4 {
        margin: 0 auto;
    }
</style>
<script>
    $(document).ready(function () {
        var setValue = function () {
            var daterangepicker = $("#daterangepicker").data("kendoDateRangePicker");
            var range = daterangepicker.range();

            document.getElementById("start").value = kendo.toString(range.start, "dd.MM.yyyy HH:mm:ss");
            document.getElementById("end").value = kendo.toString(range.end, "dd.MM.yyyy HH:mm:ss");
        };
        $("#set").click(setValue);
    });

    var values = @Json.Serialize(Model.UsersInProjects);

    function onChange() {
        let sel1 = document.getElementById("sel1");
        let sel2 = document.getElementById("sel2");
        let index = sel1.selectedIndex;
        let options = values[index];
        for (let i = sel2.options.length; i >= 0; i--) {
            sel2.options.remove(i);
        }
        for (let i = 0; i < options.length; i++) {
            let option = new Option();
            option.text = options[i];
            option.value = options[i];
            sel2.options.add(option);
        }
    }
</script>
<div class="text-center">
    <h2>Создать отчет</h2>

</div>
<br>
<div class="row">
    <div class="container4">
        <form asp-action="Create" method="post">
            <input id="start" type="text" asp-for="Start" hidden />
            <input id="end" type="text" asp-for="End" hidden />
            <div class="form-group">
                <h5><label for="CreateReport">Название отчета</label></h5>
                <input asp-for="ReportName" class="form-control" />
                <span asp-validation-for="ReportName" class="text-danger"></span>
            </div>
            <div class="form-group">
                <h5><label for="CreateReport">Проект</label></h5>
                <select asp-for="ProjectName" id="sel1" onchange="onChange()">
                    @foreach (var project in Model.ProjectNames)
                    {
                        <option value="@project">@project</option>
                    }
                </select>
            </div>
            <div class="form-group">
                <h5><label for="CreateReport">Фильтр</label></h5>
                <input asp-for="IssueFilter" class="form-control" />
                <span asp-validation-for="IssueFilter" class="text-danger"></span>
            </div>
            <div class="form-group">
                <h5><label for="CreateReport">Пользователь</label></h5>
                <select asp-for="UserName" id="sel2">
                    @foreach(var user in Model.UsersInProjects[0])
                    {
                        <option value="@user">@user</option>
                    }
                </select>
            </div>
            <div class="form-group">
                <h5>Дата создания</h5>
                @(Html.Kendo().DateRangePicker()
                    .Name("daterangepicker")
                    .HtmlAttributes(new { style = "width: 100%", title = "daterangepicker" })
                    .Range(c =>
                    {
                        c.Start(Model.Start);
                        c.End(Model.End);
                    })
                )
            </div>
            <br>
            <br>
            <div class="text-center">
                <button id="set" type="submit" class="btn btn-success btn-lg">Создать</button>
            </div>
        </form>
    </div>
</div>
<div>
    <form asp-action="Index" method="get">
        <button type="submit" style="position:absolute; bottom:10px; left:10px">Назад</button>
    </form>
</div>
