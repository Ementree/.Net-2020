@using DotNet2020.Domain._6.Models.ViewModels
@using DotNet2020.Domain._6.Services
@{
    Layout = "~/Views/Shared/_Layout6.cshtml";
    List<string> months = MonthGeneratorService.GetAllMonths(DateTime.Now.Year);
    List<int[]> CureentGroupCommonBothCapacityCount = new List<int[]>();
}

@model FunctionalCapacityViewModel
    <script src="~/wwwroot6/js/FunctionalCapacityScript.js"></script>

    <form id="changeYearForm" asp-action="Index" class="m-2 p-2">
        Год -
        <select id="changeYearSelector" name="year">
            @for (int i = Model.YearsRange.Item1; i <= Model.YearsRange.Item2; i++)
            {
                if (i == Model.CurrentYear)
                {
                    <option value="@(i)" selected="selected">@(i)</option>
                }
                else
                {
                    <option value="@(i)">@(i)</option>
                }
            }
        </select>
    </form>
<div class="fcwrapper">
    <div class="fcscroller1">
        <table class="fcscroll-table table bottom">
            <thead>
                <tr>
                    <td class="fcsticky-col1 left">
                        &nbsp;
                    </td>
                    @foreach (var m in months)
                    {
                        <th class="month-column-left-border month-column-right-border" colspan="2">
                            @m
                        </th>
                    }
                </tr>
                <tr>
                    <th class="fcsticky-col1 left align-center">
                        <p>Ресурс</p>
                    </th>
                    @foreach (var m in months)
                    {
                        <th class="right month-column-left-border">
                            план,%
                        </th>
                        <th class="month-column-right-border">
                            мощность,%
                        </th>
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (var pair in Model.Dict)
                {

                    CureentGroupCommonBothCapacityCount = new List<int[]>();

                    for(int i = 0; i < 12;i++)
                    {
                        CureentGroupCommonBothCapacityCount.Add(new int[2]);
                    }

                <tr>
                    <td class="fcsticky-col1 left h45">
                        <h6>@pair.Key</h6>
                    </td>

                        @for (int i = 0; i < 12; i++)
                        {
                            <td class="right h45 month-column-left-border">
                            </td>
                            <td class="month-column-right-border h45">
                            </td>
                        }
                </tr>

                    @foreach (var m in pair.Value)
                    {
                        <tr>
                            <td class="fcsticky-col1 left h45">
                                @(m.Resource.FirstName + " " + m.Resource.LastName)
                            </td>
                            @{ 
                                int counter = 0;
                            }
                            @foreach (var capacItem in m.YearItemsDict[Model.CurrentYear])
                            {

                                <td class="right align-center h45 month-column-left-border">
                                    @capacItem.PlannedCapacity%
                                    @{ 
                                        CureentGroupCommonBothCapacityCount[counter][0] += capacItem.PlannedCapacity;
                                    }
                                </td>
                                <td class="month-column-right-border align-center h45">
                                    @capacItem.CurrentCapacity%
                                    @{ 
                                        CureentGroupCommonBothCapacityCount[counter][1] += capacItem.CurrentCapacity;
                                        counter++;
                                    }
                                </td>
                            }
                        </tr>
                    }

                    <tr class="total">
                        <td class="fcsticky-col1 left h45 total">
                            <h6>Всего(@(pair.Key))</h6>
                        </td>
                            @for(int i =0; i < 12; i++)
                            {
                                <td class="right align-center h45 total month-column-left-border">
                                    @CureentGroupCommonBothCapacityCount[i][0]%
                                </td>
                                <td class="month-column-right-border align-center h45 total">
                                    @CureentGroupCommonBothCapacityCount[i][1]%
                                </td>
                            }
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>